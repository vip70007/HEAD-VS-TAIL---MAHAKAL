<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HEAD VS TAIL - MAHAKAL</title>
<style>
:root{--bg:#0b1220;--card:#0f1730;--accent:#7c3aed;--muted:#9aa4c0}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;min-height:100vh;margin:0;background:linear-gradient(180deg,#041026 0%, #06142a 100%);color:#e6eef8;display:flex;align-items:center;justify-content:center;padding:20px}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:14px;padding:24px;max-width:540px;width:100%;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
h1{margin:0 0 12px;font-size:20px}
.row{display:flex;gap:12px;align-items:center}
label{font-size:13px;color:var(--muted)}
input[type="text"]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
button{padding:10px 14px;border-radius:10px;border:none;background:var(--accent);color:white;cursor:pointer}
.coin-wrap{display:flex;flex-direction:column;align-items:center;margin:18px 0}
.coin{width:160px;height:160px;position:relative;transform-style:preserve-3d;cursor:pointer}
.coin-face{position:absolute;inset:0;border-radius:50%;background-size:cover;background-position:center;backface-visibility:hidden}
.face-front{background-image:url('head.png')}
.face-back{background-image:url('tail.png');transform:rotateY(180deg)}
.shadow{width:120px;height:18px;border-radius:50%;background:rgba(0,0,0,0.35);filter:blur(6px);margin-top:10px;transition:all 0.3s}
.result{margin-top:12px;text-align:center;font-size:48px;color:yellow;font-weight:bold}
.small{font-size:12px;color:var(--muted)}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.6)}
.modal .box{background:var(--card);padding:18px;border-radius:12px;width:320px}
.history-list{max-height:180px;overflow:auto;margin-top:10px;border-radius:8px;padding:8px;background:rgba(255,255,255,0.02)}
.countdown{font-weight:700;color:#ffd369}
@media (max-width:520px){.coin{width:120px;height:120px}}
</style>
</head>
<body>
<div class="card">
<h1>HEAD VS TAIL - MAHAKAL</h1>
<div class="row">
<div style="flex:1">
<label>Mobile number (10 digits)</label>
<input id="mobile" type="text" inputmode="numeric" maxlength="10" placeholder="Enter mobile number" />
<div id="mobile-info" class="small"></div>
</div>
<div><label>&nbsp;</label><button id="submit-mobile">Submit</button></div>
<div><label>&nbsp;</label><button id="admin-login">Admin Login</button></div>
</div>

<div class="coin-wrap">
<div id="coin" class="coin" title="Click to toss">
<div class="coin-face face-front"></div>
<div class="coin-face face-back"></div>
</div>
<div id="shadow" class="shadow"></div>
<div id="result" class="result">Result will show here</div>
</div>

<div class="small" style="margin-top:10px">Note: each mobile number can use once then autolock for 7 days (countdown shown when locked).</div>
</div>

<div id="modal" class="modal">
<div class="box">
<div style="display:flex;justify-content:space-between;align-items:center">
<strong id="modal-title">Admin</strong>
<button id="modal-close">X</button>
</div>
<div id="modal-body" style="margin-top:8px"></div>
</div>
</div>

<script>
const ADMIN_PASSWORD='vipin@2025', LOCK_DAYS=7, LOCK_MS=LOCK_DAYS*24*60*60*1000;
const HISTORY_KEY='coin_history_v1', LOCKS_KEY='coin_locks_v1';
const el=id=>document.getElementById(id), now=()=>Date.now();
function loadHistory(){try{return JSON.parse(localStorage.getItem(HISTORY_KEY)||'[]')}catch(e){return []}}
function saveHistory(h){localStorage.setItem(HISTORY_KEY,JSON.stringify(h))}
function loadLocks(){try{return JSON.parse(localStorage.getItem(LOCKS_KEY)||'{}')}catch(e){return {}}}
function saveLocks(l){localStorage.setItem(LOCKS_KEY,JSON.stringify(l))}

const mobileInput=el('mobile'), submitMobile=el('submit-mobile'), resultEl=el('result');
const coinEl=el('coin'), shadowEl=el('shadow'), adminLoginBtn=el('admin-login');
const modal=el('modal'), modalBody=el('modal-body'), modalTitle=el('modal-title'), modalClose=el('modal-close');
const mobileInfo=el('mobile-info');

let currentMobile=null;

function formatTs(ts){const d=new Date(ts);return d.toLocaleString()}
function getLockExpiry(m){const locks=loadLocks();return locks[m]||null}
function isLocked(m){const exp=getLockExpiry(m);return exp&&exp>now()}
function lockMobile(m){const locks=loadLocks();locks[m]=now()+LOCK_MS;saveLocks(locks)}
function startCountdown(m){clearInterval(mobileInfo._int);const update=()=>{const exp=getLockExpiry(m);if(!exp){mobileInfo.textContent='';return}const diff=exp-now();if(diff<=0){mobileInfo.textContent='Unlocked';return}const d=Math.floor(diff/86400000),h=Math.floor(diff%86400000/3600000),mi=Math.floor(diff%3600000/60000),s=Math.floor(diff%60000/1000);mobileInfo.innerHTML=`Locked for <span class="countdown">${d}d ${h}h ${mi}m ${s}s</span>`};update();mobileInfo._int=setInterval(update,1000)}

submitMobile.addEventListener('click',()=>{
  const m=mobileInput.value.trim();
  if(!/^\d{10}$/.test(m)){alert('Enter valid 10 digit mobile');return}
  currentMobile=m;
  if(isLocked(m)){startCountdown(m);resultEl.textContent='Number locked — wait for countdown.';return}
  const hist=loadHistory(), prev=hist.find(h=>h.mobile===m);
  if(prev){resultEl.innerHTML=`Result: ${prev.result} — ${prev.points} points`;startCountdown(m);return}
  resultEl.textContent='Ready. Tap the coin to toss.';
  mobileInfo.textContent='This number will be locked for 7 days after a toss.';
});

function doToss(){
  if(!currentMobile){alert('Submit your mobile first');return}
  if(isLocked(currentMobile)){resultEl.textContent='Number locked';return}
  const spins=6+Math.floor(Math.random()*6);
  const final=Math.random()<0.5?'HEAD':'TAIL';
  const points=final==='HEAD'?501:251;

  let duration=5000;
  const startY=0, peakY=-250;
  const startTime=performance.now();

  const audioTing=new Audio('ting.mp3'), audioClink=new Audio('clink.mp3');
  audioTing.play();

  function animateCoin(nowTime){
    const t=nowTime-startTime;
    const progress=Math.min(t/duration,1);
    const translateY = progress<0.5 ?
      startY + (peakY-startY)*(progress/0.5) :
      peakY + (0-peakY)*((progress-0.5)/0.5);
    const rotateX=spins*360*progress;
    const rotateY=spins*180*progress + (final==='HEAD'?0:180);
    coinEl.style.transform=`translateY(${translateY}px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
    shadowEl.style.transform=`scale(${1-progress*0.3}) translateY(${translateY/25}px)`;

    if(progress<1){requestAnimationFrame(animateCoin)}
    else{
      audioClink.play();
      coinEl.style.transform=`rotateY(${final==='HEAD'?0:180}deg)`;
      shadowEl.style.transform='scale(1)';
      resultEl.innerHTML=`Result: ${final} — ${points} points`;
      const h=loadHistory();h.unshift({mobile:currentMobile,result:final,points:points,ts:now()});saveHistory(h); // 🔥 No slice, full history saved
      lockMobile(currentMobile);startCountdown(currentMobile);
    }
  }
  requestAnimationFrame(animateCoin);
}

coinEl.addEventListener('click',doToss);

adminLoginBtn.addEventListener('click',()=>{
  const p=prompt('Enter admin password');if(p!==ADMIN_PASSWORD){alert('Wrong password');return}
  const hist=loadHistory();let html='';
  if(hist.length===0){html='<div class="small">No history yet</div>'}
  else{
    html='<div class="history-list">';
    hist.forEach(h=>{html+=`<div style="padding:6px;margin-bottom:6px;background:rgba(255,255,255,0.05);border-radius:6px"><strong>${h.result}</strong> — ${h.mobile} — ${h.points} pts<div class="small">${formatTs(h.ts)}</div></div>`});
    html+='</div><button id="delete-history" style="margin-top:10px;padding:8px 12px;border-radius:8px;border:none;background:#c00;color:#fff">Delete History</button>';
  }
  modalTitle.textContent='History';modalBody.innerHTML=html;openModal();
  const del=modalBody.querySelector('#delete-history');if(del)del.addEventListener('click',()=>{if(confirm('Delete all history?')){localStorage.removeItem(HISTORY_KEY);alert('History deleted');closeModal();}});
});

function openModal(){modal.style.display='flex'}
function closeModal(){modal.style.display='none'}
modalClose.addEventListener('click',closeModal);
modal.addEventListener('click',e=>{if(e.target===modal)closeModal()});
</script>
</body>
</html>
